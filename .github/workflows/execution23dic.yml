name: GraphWord Deployment with LocalStack

on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  setup-environment:
    runs-on: ubuntu-22.04
    steps:
      # 1. Checkout el c칩digo
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Configuraci칩n de Python
      - name: Set up Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.9'

      # 3. Instalar dependencias necesarias
      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install boto3 localstack

  start-localstack:
    needs: setup-environment
    runs-on: ubuntu-22.04
    steps:
      # 1. Configurar LocalStack
      - name: Start LocalStack
        run: |
          pip install localstack
          localstack start -d
      # 2. Verificar que LocalStack est치 corriendo
      - name: Verify LocalStack
        run: |
          curl http://localhost:4566/health

  run-deployment:
    needs: [setup-environment, start-localstack]
    runs-on: ubuntu-22.04
    steps:
      # 1. Checkout el c칩digo
      - name: Checkout code
        uses: actions/checkout@v3

      # 2. Ejecutar el script de despliegue
      - name: Run deployment script
        run: |
          python src/deployment.py
